// Generated by CoffeeScript 1.9.0
(function() {
  var allRequest, btn, getURLCallback, jsonParse, main, tasks;
  getURLCallback = function(url, callback) {
    var req;
    req = new XMLHttpRequest();
    req.open("GET", url, true);
    req.onload = function() {
      if (req.status === 200) {
        console.log("req.onload and req.status is 200");
        return callback(null, req.responseText);
      } else {
        console.log("req.onload and req.status isn't 200");
        return callback(new Error(req.statusText, req.response));
      }
    };
    req.onerror = function() {
      console.log("req.onerror");
      return callback(new Error(req.statusText));
    };
    return req.send();
  };
  jsonParse = function(callback, err, value) {
    var e, result;
    if (err) {
      return callback(err, value);
    } else {
      try {
        result = JSON.parse(value);
        return callback(null, result);
      } catch (_error) {
        e = _error;
        return callback(e, value);
      }
    }
  };
  allRequest = function(requests, callback, results) {
    var task;
    if (requests.length === 0) {
      return callback(null, results);
    }
    task = requests.shift();
    return task(function(err, value) {
      if (err) {
        return callback(err, value);
      } else {
        results.push(value);
        return allRequest(requests, callback, results);
      }
    });
  };
  tasks = {
    comment: function(callback) {
      var url;
      url = "http://localhost:3000/json/comment.json";
      return getURLCallback(url, jsonParse.bind(null, callback));
    },
    people: function(callback) {
      var url;
      url = "http://localhost:3000/json/people.json";
      return getURLCallback(url, jsonParse.bind(null, callback));
    }
  };
  main = function(callback) {
    return allRequest([tasks.comment, tasks.people], callback, []);
  };
  btn = document.getElementById("run");
  return btn.addEventListener("click", function() {
    return main(function(err, results) {
      if (err) {
        return console.error(err);
      } else {
        console.log("click end");
        return console.dir(results);
      }
    });
  });
})();
